********************************************************************************
 * STATA Syntax for the ENA vulnerability classification methodology
 *******************************************************************************
						   
/*
NOTES:
						   
- This syntax file is based on the vulnerability classification methodology recommended for Essential Needs Assessments. This classification is based on the combination of three indicators: the Economic Capacity to Meet Essential Needs (ECMEN), the Livelihood Coping Index for Essential Needs (LCS-EN), and the Food Consumption Score (FCS). However, the vulnerability classification methodolgy can be adapted based on programme needs. See chapter 6 of the Essential Needs Assessment guidance note for more details.

- The syntax files assumes that ECMEN, LCS-EN, and FCS have already been computed based on standard syntax available in github (https://github.com/WFP-VAM/RAMResourcesScripts/tree/main/Indicators). The following variables should have been defined before running this file:
	ECMEN_exclAsst
	ECMEN_exclAsst_SMEB		
	Max_coping_behaviourEN
	FCSCat28 
	FCSCat21 
*/

*------------------------------------------------------------------------------*
*1. Create temporary variables
*------------------------------------------------------------------------------*

*** Create a categorical variable for ECMEN that inform if a household is above MEB, betweeen MEB and SMEB, or below SMEB

gen temp_ECMEN_categ = .
replace temp_ECMEN_categ = 0 if ECMEN_exclAsst == 1
replace temp_ECMEN_categ = 1 if ECMEN_exclAsst == 0 & ECMEN_exclAsst_SMEB == 1
replace temp_ECMEN_categ = 2 if ECMEN_exclAsst_SMEB == 0

** Label the values
label define ECMEN_categ 2 "below SMEB" 1 "below MEB and above SMEB"  0 "above MEB"
label value temp_ECMEN_categ ECMEN_categ

*** Declare whether the 21 or 28 treshold is used for FCS
gen temp_FCS_categ = FCSCat21 // ! replace with FCSCat28 if the CO uses 28 treshold !


*------------------------------------------------------------------------------*
*2. Classify households into vulnerability categories
*------------------------------------------------------------------------------*

gen ENA_vulnerability = .

replace ENA_vulnerability = 3 	if temp_ECMEN_categ == 2 | 	Max_coping_behaviourEN == 4 |	temp_FCS_categ == 1

replace ENA_vulnerability = 4 	if temp_ECMEN_categ == 2 & 	Max_coping_behaviourEN == 4 
replace ENA_vulnerability = 4 	if temp_ECMEN_categ == 2 &								 	temp_FCS_categ == 1			
replace ENA_vulnerability = 4 	if							Max_coping_behaviourEN == 4	& 	temp_FCS_categ == 1

replace ENA_vulnerability = 2	if temp_ECMEN_categ == 1 & 	Max_coping_behaviourEN < 4 	&	inrange(temp_FCS_categ,2,3)
replace ENA_vulnerability = 2	if temp_ECMEN_categ == 0 &	Max_coping_behaviourEN == 3	& 	inrange(temp_FCS_categ,2,3)
replace ENA_vulnerability = 2	if temp_ECMEN_categ == 0 &	Max_coping_behaviourEN < 3	&	temp_FCS_categ == 2

replace ENA_vulnerability = 1	if temp_ECMEN_categ == 0 &	Max_coping_behaviourEN < 3	&	temp_FCS_categ ==3

* Label the variable
label define vulnerability_tiers 1 "Not vulnerable" 2 "Moderately vulnerable" 3 "Highly vulnerable" 4 "Extremely vulnerable"
label values ENA_vulnerability vulnerability_tiers

*** Calculate the population share in vulnerability tiers
tab ENA_vulnerability

* drop unnecessary variables
drop temp_ECMEN_categ temp_FCS_categ 